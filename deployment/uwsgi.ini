[uwsgi]
# uWSGI 配置文件用于运行 FastAPI 后端
# 路径: /home/ai-tracks-shopping-react/htdocs/shopping-react.ai-tracks.com/backend

plugins = python3
master = true

# 监听 HTTP socket (匹配 Nginx proxy_pass)
http-socket = 127.0.0.1:8096

# FastAPI 应用入口
wsgi-file = /home/ai-tracks-shopping-react/htdocs/shopping-react.ai-tracks.com/backend/wsgi.py
callable = application

# 工作目录
chdir = /home/ai-tracks-shopping-react/htdocs/shopping-react.ai-tracks.com/backend

# Python 虚拟环境
virtualenv = /home/ai-tracks-shopping-react/htdocs/shopping-react.ai-tracks.com/backend/.venv

# 进程和线程配置
processes = 8
threads = 2
enable-threads = true

# 缓冲区大小
buffer-size = 65535

# 内存和请求限制
reload-on-rss = 512
max-requests = 1000
max-requests-delta = 500
harakiri = 60

# 权限设置
umask = 0022
uid = ai-tracks-shopping-react
gid = ai-tracks-shopping-react

# 进程管理
die-on-term = true
vacuum = true

# Cheaper mode (动态进程管理)
cheaper = 2
cheaper-initial = 2
cheaper-step = 2
cheaper-algo = spare

# 日志
logto = /var/log/uwsgi/shopping-react-backend.log
log-maxsize = 50000000
log-backupcount = 5

# 自动重载（开发时使用，生产环境可注释）
# py-autoreload = 1

# 环境变量（如果需要）
# env = ENVIRONMENT=production
# env = DATABASE_URL=...

# 如果需要使用 ASGI，可以安装 uwsgi-asgi 插件
# 但 FastAPI 也可以通过 WSGI 模式运行（使用 asgiref 的 WSGIToASGIAdapter）
# 或者使用 gunicorn + uvicorn workers

